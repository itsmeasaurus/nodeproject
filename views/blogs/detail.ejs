<!doctype html>
<html lang="en">
<%- include('./../partials/header.ejs') %>
<body>
    <header>
        <h1>Blog Maker</h1>
        <%- include('./../partials/nav.ejs') %>
    </header>

    <section>
        <h2>Edit Blog</h2>
        <div>
            <form method="PATCH">
                <div>
                    <label for="title">Blog Title</label>
                    <input type="text" id="title" name="title" value="<%= blog.title %>">
                </div>
                <div>
                    <label for="description">Blog Description</label>
                    <input type="text" id="description" name="description" value="<%= blog.description %>">
                </div>
                <div>
                    <label for="body">Blog Body</label>
                    <textarea name="body" id="body" cols="30" rows="10"><%= blog.body %></textarea>
                </div>
                <div>
                    <button class="update-button" data-id="<%= blog._id %>">Update</button>
                </div>
            </form>
        </div>
        <button class="delete-button" data-id="<%= blog._id %>">Delete</button>
    </section>

    
    <script>
        const deleteBtn = document.querySelector('.delete-button')
        deleteBtn.addEventListener('click', e => {
            const endPoint = `/blogs/${deleteBtn.dataset.id}`
            fetch(endPoint, {
                method: 'DELETE'
            })
            .then(res => res.json())
            .then(data => window.location = data.redirect)
            .catch(err => console.log(err))
        })


        const updateBtn = document.querySelector('.update-button')
        updateBtn.addEventListener('click', e => {
            e.preventDefault()
            const endPoint = `/blogs/${updateBtn.dataset.id}`
            const updatedData = {
                title: document.querySelector('#title').value,
                description: document.querySelector('#description').value,
                body: document.querySelector('#body').value,
            }

            fetch(endPoint, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json'},
                body: JSON.stringify(updatedData)
            })
            .then(res => res.json())
            .then(data => window.location = data.redirect)
            .catch(err => console.log(err))
        })
    </script>
</body>
</html>